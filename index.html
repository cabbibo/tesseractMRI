<html>
  <head>

    <style>
    
      @font-face {
        font-family: "GeoSans";
        src: url("/allSiteLib/GeosansLight.ttf");
      }

    </style>

  </head>
  
  <body style="background:#000">
  
  <script src = "/allSiteLib/three.min.js" >                                </script>
  <script src = "/allSiteLib/ConvexGeometry.js" >                           </script>
  
  <script src = "/allSiteLib/OrbitControls.js" >                            </script>
  <script src = "/allSiteLib/leap.js" >                                     </script>
  <script src = "/allSiteLib/stats.min.js" >                                </script>
  <script src = "/allSiteLib/underscore.js" >                               </script>
  <script src = "/allSiteLib/js/AUDIO.js" >                                 </script>
  <script src = "/allSiteLib/math.js" >                                     </script>
  <script src = "/allSiteLib/js/OBJloader.js">                              </script>
  
  <script src = "lib/gl-matrix-min.js" >                                    </script>
  <script src = "lib/textureFromString.js">                                 </script>
  <script src = "lib/2d.js">                                                </script>
  <script src = "lib/3d.js">                                                </script>
  <script src = "lib/4d.js">                                                </script>
  <script src = "lib/loop.js">                                              </script>
  <script src = "lib/audio.js">                                             </script>
  <script src = "lib/scene.js">                                             </script>
  <script src = "lib/Tween.js">                                             </script>
  <script src = "lib/sliding.js">                                           </script>
  <script src = "lib/jquery-1.7.1.min.js">                                  </script>
  <script src = "lib/keyStrokes.js">                                        </script>
  
  <script src = "lib/App.js">                                               </script>

  <script src = "lib/boxHelper.js" >                                        </script>
  <script src = "lib/perlin.js">                                            </script>
  <script src = "lib/ParticleEmitter.js">                                   </script>
  <script src = "lib/mandala.js">                                           </script>
  <script src = "lib/particleRing.js">                                      </script>
  <script src = "lib/tesseract.js">                                         </script>
  
  <div id="container" style="position:absolute;top:0;left:0"></div>
  <div id="curtain"></div>

  <div style="font-family: GeoSans; color: #fff; position:absolute; top: 0px; visibility:hidden;">Disgusting CSS Hack</div>

  <script>

    var app , textCreator , slides;

    var AWESOME;

    var colors = {

      light1: 0xE3C99C,
      light2: 0xE3B28B,
      light3: 0xE28B7D,

      dark1:  0x443311,
      dark2:  0x552200,
      dark3:  0x660000,
      dark4:  0x663311,
      dark5:  0x330011,
      dark6:  0x443322

    }



    app  = new App();
    
    app.particleRing = new ParticleRing();
    //scene.remove( app.particleRing );

    initTesseractModel();

    console.log( app );

    //tween = new TWEEN();

    app.update = function(){

      drawIntersections();
      checkForHitCorners();
      //updateEmitters();

      //tween.update();

      if( app.projectionScene.active == true ){
        updateTesseractModel();
        this.particleRing.update();
      }


      if( app.uiScene.active == true ){
        this.ui2d.update();
        this.ui3d.update();
      }


      if( app.sliceScene.active == true ){
        updateEmitters();
        this.updateMandalas();

      }

    }

    app.cornerHit = function(i){

      notes.array[ hitCorners[i][0] ].play();

      var whichCorner = hitCorners[i][0];
      
      var p = getCornerPosition( whichCorner );

      cornerEmitter.position = convertToThree( p[0] );
      cornerEmitter.scene.position = cornerEmitter.position;

      //*if( AWESOME == true ){

        if( hitCorners[i][1] == "life" ){
          tesseractModel.add( tesseractModel.corners[whichCorner] );
          tesseractModel.corners[ whichCorner ].material = particleMaterials[1].clone();
          tesseractModel.corners[ whichCorner ].material.opacity = 1;
          //cornerEmitter.birth();
        }else if( hitCorners[i][1] == "death" ){
          tesseractModel.add( tesseractModel.corners[whichCorner] );
          tesseractModel.corners[ whichCorner ].material = particleMaterials[2].clone();
          tesseractModel.corners[ whichCorner ].material.opacity = 1;
          //cornerEmitter.death();
        }else if( hitCorners[i][1] == "sleep" ){
          tesseractModel.add( tesseractModel.corners[whichCorner] );
          tesseractModel.corners[ whichCorner ].material = particleMaterials[3].clone();
          tesseractModel.corners[ whichCorner ].material.opacity = 1;
          //cornerEmitter.sleep();
        }else{
          console.log('WTF');
        }

      //}*/


      //tesseractModel.corners[ whichCorner ].material = particleMaterials[1];

      cornerEmitter.position.x = 100000;

    }

    function initUI(){

      textCreator = new THREE.TextCreator();

      app.ui2d = new Controller2D();
      app.ui3d = new Controller3D();

      app.uiScene         = new THREE.Object3D();
      app.projectionScene = new THREE.Object3D(); 
      app.sliceScene      = new THREE.Object3D();

      scene.add( app.uiScene );
      scene.add( app.projectionScene );
      scene.add( app.sliceScene );

    
      app.uiScene.add( app.ui2d.renderer.scene );
      app.uiScene.add( app.ui3d.renderer.scene );

      app.uiScene.position.x = -10;
      app.uiScene.scale.multiplyScalar( .5 );
      app.ui2d.renderer.scene.position.y = 1.5;
      app.ui3d.renderer.scene.position.y = -1.5;

      app.uiScene.active = false;


      app.sliceScene.add( app.mandalaScene );
      app.sliceScene.add( tesseractScene );
      app.sliceScene.add( particleScene ); 
      app.sliceScene.position.x = 10;

      app.sliceScene.active = false;
      
      app.projectionScene.add( app.particleRing.scene );
      app.projectionScene.add( tesseractModel );
      tesseractModel.scale.multiplyScalar( .2 );
      
      app.projectionScene.position.x = 0;

      app.projectionScene.active = true;

      slides = [ app.uiScene , app.projectionScene , app.sliceScene ];

    }

    // Starting our function after the font
    // has been loaded
    setTimeout( initUI , 1000 );

  </script>

</body>

  
